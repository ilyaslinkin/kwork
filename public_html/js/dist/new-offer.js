!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/",s(s.s=155)}({155:function(t,e,s){t.exports=s(156)},156:function(t,e,s){s(66),s(82)},66:function(e,s,i){"use strict";function r(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}i.r(s),i.d(s,"OfferStages",(function(){return a}));var a=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.notChangeShowErrorsBlock=!1,this.errorsStage=[],this.isDisableButtonSend=!1,this.totalPrice=0,this.durationError=!1,this.ACTOR_TYPE_WORKER="worker",this.PAGE_TRACK="track",this.PAGE_OFFER="offer",this.ACTOR_TYPE_PAYER="payer",this.selectors={offerStages:".js-offer-stages",stages:".js-stages",stage:{itemDefault:".js-stage-default",item:".js-stage",infoBlock:".offer-individual__stage-info",number:".js-stage-number",numberSelect:".js-stage-number-select",title:".js-stage-name",titleEditor:".js-content-editor",titleText:".js-stage-name-text",titleBlock:".offer-individual__stage-name",price:".js-stage-price",priceText:".js-stage-price-text",error:".js-stage-error",add:".js-stage-add",edit:".js-stage-edit",save:".js-stage-save",remove:".js-stage-delete"},totalPrice:{block:".js-stage-total-price",wrap:".js-stage-total-price-wrap",price:".js-offer-total-price",priceCommission:".js-stage-total-price-commission",error:".js-stage-total-price-error",addPayerBlock:".js-stage-total-price-add-payer-block",addPayer:".js-stage-total-price-add-payer",priceWithCommission:".js-price-explanation"},textLimit:".js-stage-limit",duration:".js-stages-duration",durationValue:".js-stages-duration-value",durationChange:".js-stages-duration-change",durationChangeSelect:".js-stages-duration-change-select",durationChangeError:".js-stages-duration-change-error",customPrice:".js-kwork-price"},this.classes={stageItem:"js-stage",stageEdit:"stage-edit",stageError:"stage-error",disableAddStage:"disable",enStages:"offer-stages--en",stageActive:"offer-individual__stage--active",durationError:"duration-error",durationErrorLight:"duration-error-light"},this.stagesOfferBlock=$(this.selectors.offerStages),this.timerValidateTitle=null}var s,i,a;return s=e,a=[{key:"setStageNewNumber",value:function(t,e){t.attr("data-new-number",e).data("new-number",e)}},{key:"setStageNewPosition",value:function(t,e){t.attr("data-new-position",e).data("new-position",e)}},{key:"scrollToError",value:function(t){t.length&&$("html, body").animate({scrollTop:t.offset().top-$(".header").height()-23},"slow")}}],(i=[{key:"init",value:function(t){this.options&&(this.prevOption=this.options),this.options=t}},{key:"updateOptionsStageMinPrice",value:function(t){this.options.offer.stageMinPrice=t}},{key:"initPrev",value:function(){this.prevOption&&(this.options=this.prevOption)}},{key:"events",value:function(){var t=this;this.stagesOfferBlock.off("click change input").on("change",this.selectors.stage.numberSelect,(function(e){t.defaultNotChangeShowErrorsBlock(),t.validateStageNumber($(e.target)),t.isEnableAddStage(!0),t.onChangeStage()})).on("input",this.selectors.stage.title,(function(e){t.defaultNotChangeShowErrorsBlock();var s=$(e.target).parents(t.selectors.stage.item);t.controlLang($(e.target)),clearTimeout(t.timerValidateTitle),t.timerValidateTitle=setTimeout((function(){t.validateStageName($(e.target)),t.showCurrentError($(e.target)),t.isEnableAddStage(!0),t.onChangeStage(),t.onEditStage(s)}),500)})).on("input",this.selectors.stage.price,(function(e){t.defaultNotChangeShowErrorsBlock();var s=$(e.target).parents(t.selectors.stage.item);t.limitMaxPrice($(e.target),t.selectors.stage.item),t.calcTotalPrice(),t.changeDurationChange(),t.validateTotalPrice(),$(t.selectors.stage.price).each((function(e){var s=$(t.selectors.stage.price).eq(e);s.val()?(t.validateStagePrice(s),t.showCurrentError(s)):(t.validateStagePrice(s,!0),t.showCurrentError(s))})),t.isEnableAddStage(!0),t.onChangeStage(),t.onEditStage(s),t.calcPlaceholder(),t.options.pageType===t.PAGE_OFFER&&t.updateCustomPrice()})).on("click",this.selectors.stage.add,(function(){t.defaultNotChangeShowErrorsBlock(),t.addStage()&&(t.isEnableAddStage(!0),t.onChangeStage())})).on("click",this.selectors.stage.remove,(function(e){t.defaultNotChangeShowErrorsBlock();var s=$(e.target).parents(t.selectors.stage.item);t.removeStage(s),t.changeDurationChange(),t.validateTotalPrice(),t.updateControlHide(),t.isEnableAddStage(!0),t.onChangeStage(),t.validateStagesPrices(),t.calcPlaceholder(),t.onDeleteStage(s)})).on("click",this.selectors.stage.edit,(function(e){var s=$(e.target).parents(t.selectors.stage.item);t.defaultNotChangeShowErrorsBlock(),t.hideTotalPriceErrorByFirstStage(),t.editStage(s)})).on("click",this.selectors.stage.save,(function(e){window.offerForm&&window.offerForm.isBusy||(t.defaultNotChangeShowErrorsBlock(),t.saveStage($(e.target).parents(t.selectors.stage.item)),t.validateTotalPrice(),t.isEnableAddStage(!0),t.onChangeStage())})).on("change",this.selectors.durationChangeSelect,(function(){t.validateDurationChange(),t.onChangeStage()})),$(window).resize((function(){t.reBuildStages()})),this.stagesOfferBlock.on("keypress",".js-content-editor",(function(e){t.eventEnter(e)})).on("keypress",this.selectors.stage.title,(function(e){t.eventEnter(e)})).on("keypress",this.selectors.stage.price,(function(e){t.eventEnter(e)}))}},{key:"eventEnter",value:function(t){13===t.keyCode&&(t.preventDefault(),$(t.target).parents(this.selectors.stage.item).find(this.selectors.stage.save).click())}},{key:"onChangeStage",value:function(){}},{key:"onDeleteStage",value:function(t){}},{key:"onEditStage",value:function(t){}},{key:"generationStages",value:function(){var t=this;this.initStagesBlock(this.options.offer.orderId),this.stagesOfferBlock.removeClass(this.classes.enStages),"en"===this.options.offer.lang&&this.stagesOfferBlock.addClass(this.classes.enStages),this.options.stages&&Object.keys(this.options.stages).length?($.each(this.options.stages,(function(e,s){t.buildStage(e+1,s.number),t.setDataStage(s)})),this.options.pageType===this.PAGE_TRACK&&this.stagesOfferBlock.find(this.selectors.stage.item).each((function(e,s){t.showStageInput($(s))}))):this.options.pageType===this.PAGE_TRACK?this.buildStage(1,this.options.countStages+1):this.options.actorType===this.ACTOR_TYPE_PAYER||this.options.pageType===this.PAGE_OFFER?(this.buildStage(1,1),this.buildStage(2,2),this.buildStage(3,3),this.setPlaceholderTitle()):this.buildStage(1,1),this.calcTotalPrice(),this.updateControlHide(),this.isEnableAddStage(!0),this.reBuildStages(),this.initTooltip(),this.setDuration(),this.events()}},{key:"initStagesBlock",value:function(t){this.stagesOfferBlock=$(this.selectors.offerStages).filter('[data-order-id="'+t+'"]')}},{key:"initTooltip",value:function(){$.fn.tooltipster&&this.stagesOfferBlock.children("div:not("+this.selectors.stage.itemDefault+")").find(".tooltip:not(.tooltipstered)").tooltipster(TOOLTIP_CONFIG)}},{key:"setDuration",value:function(){var e=this.options.offer.duration/86400,s=(e=e.toFixed(0))+" "+Utils.declOfNum(e,[t("день"),t("дня"),t("дней")]);this.stagesOfferBlock.find(this.selectors.durationValue).html(s)}},{key:"validateStages",value:function(t){var e=this;this.notChangeShowErrorsBlock="boolean"==typeof t&&t,this.errorsStage=[],this.stagesOfferBlock.find(this.selectors.stage.item).each((function(t,s){e.validateStage($(s))})),this.showAllStageErrors()}},{key:"validateStagesPrices",value:function(){var t=this;this.calcTotalPrice(),this.stagesOfferBlock.find(this.selectors.stage.item).each((function(e,s){var i=$(s).find(t.selectors.stage.price);""!==i.val()&&(t.defaultNotChangeShowErrorsBlock(),t.validateStagePrice(i),t.showCurrentError(i),t.isEnableAddStage(!0))}))}},{key:"validateStage",value:function(t){var e=this.validateStageName(t.find(this.selectors.stage.title)),s=this.validateStagePrice(t.find(this.selectors.stage.price)),i=this.validateStageNumber(t.find(this.selectors.stage.numberSelect));return e&&s&&i}},{key:"validateStageName",value:function(e){var s=e.parents(this.selectors.stage.item).data("number");this.hideStageInputError(e);var i=e.data("backendError");return i?(this.addErrorStage({target:"title",text:i,position:s}),!1):""===e.val()||0!==StopwordsModule._testContacts(e.val()).length?(this.addErrorStage({target:"title",text:t("Укажите название задачи"),position:s}),!1):(this.removeErrorStage({target:"title",position:s}),!0)}},{key:"validateStagePrice",value:function(e,s){var i=e.val(),r=e.parents(this.selectors.stage.item).data("number");if(null===r)return!1;if(s)return this.removeErrorStage({target:"payer_price",position:r}),!0;if(i=""==i?0:i,this.hideStageInputError(e),/[^0-9]/gi.test(i))return e.val(i.replace(/[^0-9]/gi,"")),!1;if(isNaN(i)||""===i)return this.addErrorStage({target:"payer_price",text:t("Укажите цену"),position:r}),!1;if(i<this.options.offer.stageMinPrice||i>this.options.offer.customMaxPrice){var a=this.options.offer.customMaxPrice-this.totalPrice+parseInt(i),o=Utils.priceFormatWithSign(this.options.offer.stageMinPrice,this.options.offer.lang),n=Utils.priceFormatWithSign(a,this.options.offer.lang),l="";return l=this.options.offer.stageMinPrice===this.options.offer.customMaxPrice||a===this.options.offer.stageMinPrice?t("Стоимость должна быть равна {{0}}",[o]):a<=this.options.offer.stageMinPrice?this.options.offer.customMaxPrice<=this.totalPrice?t("Достигнута максимальная общая стоимость задач. Отредактируйте стоимость предыдущих задач, либо удалите текущую задачу."):t("Стоимость задачи должна быть от {{0}}",[o]):t("Стоимость задачи должна быть от {{0}} до {{1}}",[o,n]),this.addErrorStage({target:"payer_price",text:l,position:r}),this.stagesOfferBlock.find(this.selectors.totalPrice.priceCommission).addClass("hidden"),!1}return this.removeErrorStage({target:"payer_price",position:r}),!0}},{key:"limitMaxPrice",value:function(t,e){for(var s=parseInt(t.val()),i=$(e),r=0,a=!1,o=0;o<i.length;o++){var n=$(i[o]).find(".js-stage-price").val();n=n||0;var l=parseInt(n);l&&l!==s||a?r+=l:l===s&&(a=!0)}isNaN(s)&&(s=""),s>this.options.offer.customMaxPrice-r&&(s=this.options.offer.customMaxPrice-r),t.val(s)}},{key:"checkSumTotalPrice",value:function(){return this.totalPrice===this.options.offer.customMaxPrice||this.options.offer.customMaxPrice-this.totalPrice<this.options.offer.stageMinPrice}},{key:"validateTotalPrice",value:function(){return this.hideTotalPriceError(),this.enableButtonSend(),this.totalPrice>this.options.offer.customMaxPrice?(this.showTotalPriceError(t("Стоимость заказа достигла предельной суммы ")+Utils.priceFormatWithSign(this.options.offer.customMaxPrice,this.options.offer.lang)),this.disableAddStage(),this.disableButtonSend(),this.stagesOfferBlock.find(this.selectors.totalPrice.priceCommission).addClass("hidden"),!1):(this.totalPrice<this.options.offer.customMinPrice&&(this.showTotalPriceError(t("Итоговая цена заказа не может быть ниже ")+Utils.priceFormatWithSign(this.options.offer.customMinPrice,this.options.offer.lang,"&nbsp;",'<span class="rouble">Р</span>')),this.disableButtonSend(),this.stagesOfferBlock.find(this.selectors.totalPrice.priceCommission).addClass("hidden")),!0)}},{key:"validateStageNumber",value:function(e){var s=this,i=!0,r=e.parents(this.selectors.stage.item).data("number");return $.each($(this.selectors.stage.numberSelect).filter(":visible"),(function(e,a){var o=$(a).parents(s.selectors.stage.item).data("number");s.removeErrorStage({position:o,target:"number"}),s.hideStageInputError($(a)),$.each($(s.selectors.stage.numberSelect).filter(":visible"),(function(e,n){var l=$(n).parents(s.selectors.stage.item).data("number");$(a).val()===$(n).val()&&o!==l&&(s.addErrorStage({position:o,target:"number",text:t("Задачи имеют одинаковый номер. Исправьте их последовательность.")}),s.showCurrentError($(a)),o===r&&(i=!1))}))})),this.reBuildStages(),i}},{key:"validateDurationChange",value:function(){return!(this.stagesOfferBlock.find(this.selectors.durationChange).is(":visible")&&isNaN(parseInt(this.stagesOfferBlock.find(this.selectors.durationChangeSelect).val()))||(this.hideDurationChangeError(),0))}},{key:"addStage",value:function(){if(this.stagesOfferBlock.find(this.selectors.stage.add).hasClass("disable")||!1===this.isEnableAddStage(!1))return!1;this.reSaveStages();var t=this.stagesOfferBlock.find(this.selectors.stage.item).length,e=this.options.countStages||0;if(t){var s=this.getMaxAndMinNumber(),i=(s.minNumber,s.maxNumber);i>=e&&(e=i)}return this.buildStage(t+1,parseInt(e)+1),this.initTooltip(),this.stagesOfferBlock.find(this.selectors.stage.item).css({"z-index":1}),this.stagesOfferBlock.find(this.selectors.stage.item).last().css({"z-index":0}),this.reBuildStages(),!0}},{key:"removeStage",value:function(t){t.remove();var e=this.getMaxAndMinNumber(),s=(e.minNumber,e.maxNumber),i=this.stagesOfferBlock.find(this.selectors.stage.item).length;this.updateSortStages(t,s+1,i+1),this.calcTotalPrice(),this.options.pageType===this.PAGE_OFFER&&this.updateCustomPrice()}},{key:"editStage",value:function(t){var e=this;this.options.actorType===this.ACTOR_TYPE_PAYER?(this.stagesOfferBlock.find(this.selectors.stage.item).each((function(t,s){e.showStageInput($(s)),e.updateNumberSelectStage($(s)),e.showNumberSelectStage($(s))})),this.selectCurrentStage(t)):(this.showStageInput(t),this.updateNumberSelectStage(t),this.showNumberSelectStage(t)),this.reBuildStages()}},{key:"saveStage",value:function(t){if(!this.validateStage(t))return this.showCurrentError(t.find(this.selectors.stage.title)),this.showCurrentError(t.find(this.selectors.stage.price)),!1;t.removeClass(this.classes.stageError),t.removeClass(this.classes.stageActive),this.showStageText(t),this.saveNumberSelectStage(t),this.hideNumberSelectStage(t),this.reBuildStages()}},{key:"reSaveStages",value:function(){var t=this;this.stagesOfferBlock.find(this.selectors.stage.item).each((function(e,s){t.saveStage($(s))}))}},{key:"checkStageCountLimit",value:function(){var t=this.stagesOfferBlock.find(this.selectors.stage.item).length;return!this.options.offer.offerMaxStages||t<this.options.offer.offerMaxStages?($(this.selectors.textLimit).addClass("hidden"),!0):($(this.selectors.textLimit).removeClass("hidden"),!1)}},{key:"calcTotalPrice",value:function(){var e=this.stagesOfferBlock.find(this.selectors.stage.item).length;this.stagesOfferBlock.find(this.selectors.totalPrice.block).addClass("hidden"),this.stagesOfferBlock.find(this.selectors.totalPrice.priceCommission).addClass("hidden"),this.options.actorType===this.ACTOR_TYPE_WORKER&&e>1&&this.stagesOfferBlock.find(this.selectors.totalPrice.block).removeClass("hidden"),this.options.actorType===this.ACTOR_TYPE_PAYER&&e>1&&""!==this.stagesOfferBlock.find(this.selectors.stage.item).filter("[data-position='1']").find(this.selectors.stage.price).val()&&""!==this.stagesOfferBlock.find(this.selectors.stage.item).filter("[data-position='2']").find(this.selectors.stage.price).val()&&this.stagesOfferBlock.find(this.selectors.totalPrice.block).removeClass("hidden"),this.options.actorType===this.ACTOR_TYPE_WORKER&&""!==this.stagesOfferBlock.find(this.selectors.stage.item).filter("[data-position='1']").find(this.selectors.stage.price).val()&&this.stagesOfferBlock.find(this.selectors.totalPrice.priceCommission).removeClass("hidden");var s=0;if(this.stagesOfferBlock.find(this.selectors.stage.price).each((function(t,e){var i=parseInt($(e).val());isNaN(i)||(s+=i)})),this.totalPrice=s,this.stagesOfferBlock.find(this.selectors.totalPrice.price).html(Utils.priceFormatWithSign(s,this.options.offer.lang,"&nbsp;",'<span class="rouble">Р</span>')),this.stagesOfferBlock.find(this.selectors.totalPrice.addPayerBlock).addClass("hidden"),this.options.actorType===this.ACTOR_TYPE_PAYER&&this.totalPrice>this.options.offer.customMinPrice&&this.totalPrice<=this.options.offer.customMaxPrice&&this.options.pageType!==this.PAGE_TRACK){var i=Math.abs(this.options.offer.customMinPrice-this.totalPrice),r=Utils.priceFormatWithSign(i,this.options.offer.lang,"&nbsp;",'<span class="rouble">Р</span>');this.stagesOfferBlock.find(this.selectors.totalPrice.addPayerBlock).removeClass("hidden"),this.stagesOfferBlock.find(this.selectors.totalPrice.addPayer).html("+"+r);var a=r.replace(/\.+$/,""),o='<div class="stage-tooltip-content">'+t("Итоговая цена, которую вы готовы заплатить, превысила ставку продавца на {{0}}. Это допустимо, особенно, если вы добавили задачи, которые не предусмотрели заранее.",[a])+"</div>";this.stagesOfferBlock.find(this.selectors.totalPrice.addPayerBlock).find(".tooltipster").tooltipster("content",o)}this.options.actorType===this.ACTOR_TYPE_WORKER?this.calcPriceWithCommission(s):this.clearPriceWithCommission()}},{key:"updateCustomPrice",value:function(){window.offerStages.totalPrice>window.offerStages.options.offer.stagesPriceThreshold&&$(window.offerStages.selectors.customPrice).val(window.offerStages.totalPrice)}},{key:"calcPriceWithCommission",value:function(e){var s=0^e,i=calculateCommission(s,this.options.turnover),r=s-i.priceKwork,a=t("Вы получите {{0}}",[Utils.priceFormatWithSign(r,this.options.offer.lang)]);a+=' <a href="javascript:void(0);" class="js-price-explanation kwork-price-explanation">'+t("Подробнее")+"</a>",$(this.selectors.totalPrice.priceCommission).html(a),this.stagesOfferBlock.find(this.selectors.totalPrice.priceWithCommission).data("commission",i)}},{key:"clearPriceWithCommission",value:function(){$(this.selectors.totalPrice.priceCommission).html("")}},{key:"changeDurationChange",value:function(){this.hideDurationChangeBlock();var e,s,i,r,a=this.stagesOfferBlock.find(this.selectors.durationChangeSelect);if(this.options.actorType===this.ACTOR_TYPE_PAYER){if(this.totalPrice>=this.options.offer.customMinPrice&&this.totalPrice<parseInt(this.options.offer.price)&&this.options.offer.stageMaxDecreaseDays)s=t("Уменьшение срока не обязательно, но допустимо."),i="green",r=t("Уменьшить срок заказа на"),e=this.options.offer.stageMaxDecreaseDays;else{if(!(this.totalPrice>parseInt(this.options.offer.price)&&this.options.offer.stageMaxIncreaseDays))return;s=t("Увеличьте срок, поскольку сумма заказа станет больше."),i="red",r=t("Добавить срок к заказу"),e=this.options.offer.stageMaxIncreaseDays}this.showDurationChangeBlock(),a.val()&&a.find("option").length===e+1||(this.showDurationChangeError(s,i),this.stagesOfferBlock.find(this.selectors.durationChange).find("label").text(r),this.reBuildDuration(e))}}},{key:"reBuildDuration",value:function(e){var s=this.stagesOfferBlock.find(this.selectors.durationChangeSelect);s.html("");for(var i='<option value="" disabled selected>'+t("Выберите срок")+"</option>",r=1;r<=e;r++)i+='<option value="'+r+'">'+r+" "+declension(r,t("день"),t("дня"),t("дней"),"ru")+"</option>";s.append(i),s.chosen({width:"100%",disable_search:!0}),s.trigger("chosen:updated")}},{key:"hideDurationChangeBlock",value:function(){this.stagesOfferBlock.find(this.selectors.durationChange).addClass("hidden"),this.hideDurationChangeError()}},{key:"showDurationChangeBlock",value:function(){this.stagesOfferBlock.find(this.selectors.durationChange).removeClass("hidden")}},{key:"showStageInput",value:function(t){t.addClass(this.classes.stageEdit)}},{key:"showStageText",value:function(t){t.removeClass(this.classes.stageEdit),t.find(this.selectors.stage.titleText).html(t.find(this.selectors.stage.title).val()),t.find(this.selectors.stage.priceText).text(Utils.priceFormat(t.find(this.selectors.stage.price).val()))}},{key:"selectCurrentStage",value:function(t){$(this.selectors.stage.item).removeClass(this.classes.stageActive),t.addClass(this.classes.stageActive)}},{key:"disableAddStage",value:function(){this.stagesOfferBlock.find(this.selectors.stage.add).addClass(this.classes.disableAddStage)}},{key:"enableAddStage",value:function(){this.stagesOfferBlock.find(this.selectors.stage.add).removeClass(this.classes.disableAddStage)}},{key:"isEnableAddStage",value:function(t){return this.validateStages(t),this.errorsStage.length||this.checkSumTotalPrice()||!this.checkStageCountLimit()?(this.disableAddStage(),!1):(this.enableAddStage(),!0)}},{key:"buildStage",value:function(t,e){var s=this.stagesOfferBlock.find(this.selectors.stage.itemDefault).html();this.stagesOfferBlock.find(this.selectors.stages).append(s);var i=this.stagesOfferBlock.find(this.selectors.stages).children().eq(t-1);i.data("number",e).attr("data-number",e).data("position",t).attr("data-position",t).attr("data-name","stage-"+e+"-title").addClass(this.classes.stageItem),i.find(this.selectors.stage.number).text(e+"."),i.find(this.selectors.stage.title).attr("name","stages["+e+"][title]"),i.find(this.selectors.stage.price).attr("name","stages["+e+"][payer_price]").attr("placeholder",this.options.offer.stageMinPrice===this.options.offer.customMaxPrice?this.options.offer.stageMinPrice:Utils.priceFormat(this.options.offer.stageMinPrice)+" - "+Utils.priceFormat(this.options.offer.customMaxPrice-this.totalPrice)),i.show(),i.addClass(this.classes.stageEdit),window.offerForm&&window.offerForm.initEventListeners(this.stagesOfferBlock)}},{key:"calcPlaceholder",value:function(){var t="",e=this.options.offer.stageMinPrice,s=this.options.offer.customMaxPrice;t=e===s||s-this.totalPrice<=e?e:Utils.priceFormat(e)+" - "+Utils.priceFormat(s-this.totalPrice),$(this.selectors.stage.price).attr("placeholder",t)}},{key:"setDataStage",value:function(t){var e=this.stagesOfferBlock.find(this.selectors.stage.item).filter("[data-number='"+t.number+"']");e.data("id",t.id).attr("data-id",t.id),e.find(this.selectors.stage.title).val(t.title),e.find(this.selectors.stage.titleText).html(t.title),e.find(this.selectors.stage.titleEditor).html(t.title),e.find(this.selectors.stage.price).val(parseInt(t.payer_price)),e.find(this.selectors.stage.priceText).text(Utils.priceFormat(t.payer_price)),e.removeClass(this.classes.stageEdit)}},{key:"setPlaceholderTitle",value:function(){this.stagesOfferBlock.find(this.selectors.stage.item).filter("[data-position='1']").find(this.selectors.stage.title).attr("placeholder",t("Первая задача")),this.stagesOfferBlock.find(this.selectors.stage.item).filter("[data-position='2']").find(this.selectors.stage.title).attr("placeholder",t("Вторая задача")),this.stagesOfferBlock.find(this.selectors.stage.item).filter("[data-position='3']").find(this.selectors.stage.title).attr("placeholder",t("Третья задача"))}},{key:"updatePlaceholderPrice",value:function(){var t=this;$.each($(this.selectors.stage.item),(function(e,s){var i=$(s),r=i.data("position");i.find(t.selectors.stage.price).attr("name","stages["+r+"][payer_price]").attr("placeholder",t.options.offer.stageMinPrice===t.options.offer.customMaxPrice?t.options.offer.stageMinPrice:Utils.priceFormat(t.options.offer.stageMinPrice)+" - "+Utils.priceFormat(t.options.offer.customMaxPrice))}))}},{key:"updateControlHide",value:function(){this.stagesOfferBlock.find(this.selectors.stage.remove).removeClass("hidden"),(this.options.pageType===this.PAGE_TRACK&&this.options.offer.customMinPrice>0||this.options.pageType!==this.PAGE_TRACK)&&this.stagesOfferBlock.find(this.selectors.stage.item).filter('[data-position="1"]').find(this.selectors.stage.remove).addClass("hidden"),this.options.actorType===this.ACTOR_TYPE_PAYER&&this.options.pageType!==this.PAGE_TRACK&&this.stagesOfferBlock.find(this.selectors.stage.item).filter('[data-position="2"]').find(this.selectors.stage.remove).addClass("hidden")}},{key:"getMaxAndMinNumber",value:function(){var t=0,e=this.stagesOfferBlock.find(this.selectors.stage.item).eq(0).data("number");return this.stagesOfferBlock.find(this.selectors.stage.item).each((function(s,i){var r=$(i).data("number");parseInt(r)>parseInt(t)&&(t=r),parseInt(r)<parseInt(e)&&(e=r)})),{maxNumber:parseInt(t),minNumber:parseInt(e)}}},{key:"updateNumberSelectStage",value:function(t){var e=t.find("select"),s="",i=parseInt(t.data("number"));if(e.val()!==i){e.html("");for(var r=this.getMaxAndMinNumber(),a=r.minNumber,o=r.maxNumber,n=a;n<=o;n++){var l=n;s+='<option data-position="'+this.stagesOfferBlock.find(this.selectors.stage.item).filter('[data-number="'+n+'"]').data("position")+'" value="'+l+'"'+(i===l?"selected":"")+">"+l+"</option>"}e.append(s)}}},{key:"showNumberSelectStage",value:function(t){this.stagesOfferBlock.find(this.selectors.stage.item).length>1&&this.options.pageType!==this.PAGE_TRACK&&(t.find(this.selectors.stage.numberSelect).removeClass("hidden"),t.find(this.selectors.stage.number).addClass("hidden"))}},{key:"hideNumberSelectStage",value:function(t){t.find(this.selectors.stage.numberSelect).addClass("hidden"),t.find(this.selectors.stage.numberSelect).val([]),t.find(this.selectors.stage.number).removeClass("hidden")}},{key:"saveNumberSelectStage",value:function(t){var e=t.find("select"),s=parseInt(e.val());isNaN(s)&&(s=t.data("number"));var i=this.getMaxAndMinNumber(),r=(i.minNumber,i.maxNumber);r<s&&(s=r);var a=parseInt(e.find('option[value="'+s+'"]').data("position"));this.updateSortStages(t,s,a),this.updateControlHide()}},{key:"updateSortStages",value:function(t,s,i){var r=t.data("number");e.setStageNewNumber(t,s),e.setStageNewPosition(t,i),this.stagesOfferBlock.find(this.selectors.stage.item).each((function(t,i){var a=$(i),o=parseInt(a.data("number")),n=parseInt(a.data("position"));o<r&&o>=s&&(e.setStageNewNumber(a,o+1),e.setStageNewPosition(a,n+1)),o>r&&o<=s&&(e.setStageNewNumber(a,o-1),e.setStageNewPosition(a,n-1))})),this.updateStageNumber(),this.reBuildStages()}},{key:"updateStageNumber",value:function(){var t=this;this.stagesOfferBlock.find(this.selectors.stage.item).each((function(e,s){var i=$(s),r=i.data("new-number")||i.data("number"),a=i.data("new-position")||i.data("position");i.attr("data-position",a).data("position",a).attr("data-number",r).data("number",r),i.find(t.selectors.stage.number).text(r+"."),i.find(t.selectors.stage.title).attr("name","stages["+r+"][title]"),i.find(t.selectors.stage.price).attr("name","stages["+r+"][payer_price]")}))}},{key:"reBuildStages",value:function(){for(var t=0,e=1;e<=this.stagesOfferBlock.find(this.selectors.stage.item).length;e++){var s=this.stagesOfferBlock.find(this.selectors.stage.item).filter("[data-position='"+e+"']"),i=s.find(this.selectors.stage.titleBlock).height(),r=s.find(this.selectors.stage.error).height(),a=($(window).width(),40);!s.hasClass(this.classes.stageEdit)&&i>a&&(a=i),s.hasClass(this.classes.stageEdit)&&(a=$(window).width()<768?80:40);var o=a;s.hasClass(this.classes.stageError)&&(a=(o=$(window).width()<768?80:40)+r),t+=a,s.css({top:t-a,height:a+"px"}),s.find(this.selectors.stage.infoBlock).css({height:o})}this.stagesOfferBlock.find(this.selectors.stages).css({height:t})}},{key:"controlLang",value:function(t){if(this.options.controlEnLang){var e=t.val().replace(/[А-Яа-яЁё]/g,"");t.val(e)}}},{key:"addErrorStage",value:function(t){this.removeErrorStage(t),this.errorsStage.push(t)}},{key:"removeErrorStage",value:function(t){this.errorsStage=this.errorsStage.filter((function(e){return!(e.target===t.target&&e.position===t.position)}))}},{key:"showBackendStageErrors",value:function(t){var s=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.length&&(this.defaultNotChangeShowErrorsBlock(),$.each(t,(function(t,e){return"price"===e.target?(s.showTotalPriceError(e.text),!0):"days"===e.target?(s.showDurationChangeError(e.text,"red"),!0):(s.showStageError(e),void s.editStage(s.stagesOfferBlock.find(s.selectors.stage.item).filter('[data-number="'+e.position+'"]')))})),i&&e.scrollToError(this.stagesOfferBlock.find(this.selectors.stage.item).filter('[data-number="'+t[0].position+'"]')))}},{key:"showAllStageErrors",value:function(){var t=this;!this.notChangeShowErrorsBlock&&this.errorsStage.length&&($.each(this.errorsStage,(function(e,s){t.showStageError(s),"payer_price"===s.target&&t.showTotalPriceError("")})),this.reBuildStages())}},{key:"showCurrentError",value:function(t){var e=t.data("target"),s=t.parents(this.selectors.stage.item).data("number"),i=this.errorsStage.filter((function(t){return t.target===e&&t.position===s}));this.hideStageInputError(t),i.length&&this.showStageError(i[0]),this.reBuildStages()}},{key:"showStageError",value:function(t){var e=t.position||1,s=this.stagesOfferBlock.find(this.selectors.stage.item).filter('[data-number="'+e+'"]');s.addClass(this.classes.stageError),s.find('input[data-target="'+t.target+'"]').addClass("error"),s.find('select[data-target="'+t.target+'"]').addClass("error"),s.find(this.selectors.stage.error).find('[data-target="'+t.target+'"]').html(t.text.replace(/\.+\s*$/,"")+". ")}},{key:"hideStageInputError",value:function(t){var e=t.parents(this.selectors.stage.item);this.notChangeShowErrorsBlock||(t.removeClass("error"),e.find(this.selectors.stage.error).find('[data-target="'+t.data("target")+'"]').html(""),""===e.find(this.selectors.stage.error).find("span").text()&&e.removeClass(this.classes.stageError),this.reBuildStages())}},{key:"checkDisableButtonSend",value:function(){return 0!==this.errorsStage.length||this.isDisableButtonSend||this.durationError}},{key:"showDurationChangeError",value:function(t,e){this.stagesOfferBlock.find(this.selectors.durationChangeError).text(t),"red"===e?(this.stagesOfferBlock.find(this.selectors.duration).addClass(this.classes.durationError),this.durationError=!0):this.stagesOfferBlock.find(this.selectors.duration).addClass(this.classes.durationErrorLight)}},{key:"hideDurationChangeError",value:function(){this.durationError=!1,this.stagesOfferBlock.find(this.selectors.durationChangeError).text(""),this.stagesOfferBlock.find(this.selectors.duration).removeClass(this.classes.durationError).removeClass(this.classes.durationErrorLight)}},{key:"showTotalPriceError",value:function(t){if(!this.notChangeShowErrorsBlock)if(1===this.stagesOfferBlock.find(this.selectors.stage.item).length){var e=this.stagesOfferBlock.find(this.selectors.stage.item).filter('[data-position="1"]').data("number");this.showStageError({position:e,target:"payer_price",text:t}),this.addErrorStage({position:e,target:"payer_price",text:t}),this.reBuildStages(),this.hideTotalPriceError()}else $(this.selectors.totalPrice.wrap).addClass("error"),$(this.selectors.totalPrice.error).html(t),$(this.selectors.totalPrice.priceCommission).addClass("hidden"),this.hideTotalPriceErrorByFirstStage()}},{key:"hideTotalPriceError",value:function(){this.notChangeShowErrorsBlock||($(this.selectors.totalPrice.wrap).removeClass("error"),$(this.selectors.totalPrice.error).html(""))}},{key:"hideTotalPriceErrorByFirstStage",value:function(){var t=this.stagesOfferBlock.find(this.selectors.stage.item).filter('[data-position="1"]'),e=t.data("number");this.hideStageInputError(t.find(this.selectors.stage.price)),this.removeErrorStage({position:e,target:"payer_price"})}},{key:"defaultNotChangeShowErrorsBlock",value:function(){this.notChangeShowErrorsBlock=!1}},{key:"disableButtonSend",value:function(){$(this.options.classDisableButton).prop("disabled",!0).addClass("disabled"),this.setButtonSend(!0)}},{key:"enableButtonSend",value:function(){$(this.options.classDisableButton).prop("disabled","").removeClass("disabled"),this.setButtonSend(!1)}},{key:"setButtonSend",value:function(t){this.isDisableButtonSend=t}}])&&r(s.prototype,i),a&&r(s,a),e}();window.offerStages=new a},82:function(e,s){window.OfferIndividualModule=function(){var e=!1,s=[],i=[],r=null,a=".js-individual-kwork",o=".js-individual-kwork-error",n={block:".js-custom-kwork",categoryWrap:".js-category-wrap",categorySelect:".js-category-select",description:".js-kwork-description",subCategoryWrap:".js-sub-category-wrap",subCategorySelect:".js-sub-category-select",duration:".js-kwork-duration",stageDuration:".js-stages-duration",title:".js-kwork-title",volume:".js-kwork-volume",price:".js-kwork-price"},l={block:".js-active-kwork"},c={wrapper:".js-offer-payment-type",full:".js-full-payment-type",stages:".js-stages-payment-type",radio:".js-new-offer-radio",hint:".js-payment-type-hint"},d=0,h=0,f=!1,u=!1,g=!1,p=null,m=function(){var t=parseInt($(n.price).val());if(t&&t>=offer.stagesPriceThreshold){var e=$(".js-new-offer-radio.offer-payment-type__radio-item--active");e&&"stages"===e.data("type")?(p="stages",g=!0,f=!0):e&&"all"===e.data("type")&&(p="all",u=!0,f=!0)}else t&&(u=!0);offer.customMinPrice>=offer.stagesPriceThreshold&&(f=!0),offer.customMaxPrice<offer.stagesPriceThreshold&&(u=!0),(u||g)&&f&&$(c.hint).removeClass("hidden")},v=function(){$(".js-request-kwork-id").chosen({width:"100%",disable_search:!0}),$(".js-request-kwork-count").chosen({width:"100%",disable_search:!0}),$(".js-request-kwork-package-type").chosen({width:"100%",disable_search:!0}),$(n.duration).chosen({width:"100%",disable_search:!0,display_disabled_options:!1}),$(n.categorySelect).chosen({width:"100%",disable_search:!0}),$(n.subCategorySelect).chosen({width:"100%",disable_search:!0}),$(".order-extras__select-block select.styled").chosen({width:"108px",disable_search:!0})},k=function(){var t=parseInt($(this).val());$(n.subCategoryWrap).each((function(){parseInt($(this).data("category-id"))===t?($(this).find("select").attr("name","offer_category"),$(this).find("select").attr("required","required"),$(this).removeClass("hidden")):($(this).find("select").attr("name",""),$(this).find("select").removeAttr("required"),$(this).addClass("hidden"))}))},S=function(t){if(e="boolean"==typeof t&&t,$(this).is("input, select, textarea")&&null!==$(this).parents(".js-offer-individual-item")){var s=$(this).parents(".js-offer-individual-item").data("target");i.includes(s)||i.push($(this).parents(".js-offer-individual-item").data("target"))}var r=[];return $(o).html(""),$(l.block).length&&!$(l.block).hasClass("hidden")?r.push(b()):r.push(w()),F(),-1!==r.indexOf(!1)?(I(),!1):(R(),!0)},b=function(){D(),_(0);var e=$(".js-request-kwork-id").val();if(!e||""===e)return!1;if($("input[name=want_id]").length&&!$("input[name=want_id]:checked").length)return!1;var s=0,i=$('input[name="customExtraName[]"]');return i&&(s=i.filter((function(){return!$(this).val()})).length),!(s>0)&&(K(),d>offer.customMaxPrice||d<offer.customMinPrice?(offer.customMaxPrice===offer.customMinPrice?$(o).html(t("Цена услуги для данного заказа не может быть более {{0}}",[Utils.priceFormatWithSign(offer.customMaxPrice,offer.lang)])):$(o).html(t("Допустимая цена услуги для данного заказа от {{0}} до {{1}}",[Utils.priceFormatWithSign(offer.customMinPrice,offer.lang),Utils.priceFormatWithSign(offer.customMaxPrice,offer.lang)])),!1):!(!window.offerForm||!window.offerForm.isValidated(["offer-description"]))&&P())},w=function(){var t=[];return t.push(Y()),t.push(P()),t.push(E()),isNaN(parseInt($("input[name=want_id]:checked").val()))&&(t.push(C()),t.push(x())),offer.isOrderStageTester&&"stages"===p?(window.offerStages.validateStages(!0),t.push(!window.offerStages.checkDisableButtonSend())):t.push(y()),!(!window.offerForm||!window.offerForm.isValidated(["offer-description","title","description"]))&&(!(offer.isOrderStageTester&&h>=offer.stagesPriceThreshold&&!p)&&-1===t.indexOf(!1))},y=function(){return D("title"),!$(n.title).siblings(".js-content-editor").is(":visible")||""!==$(n.title).val()&&0===StopwordsModule._testContacts($(n.title).val()).length||(s.push({target:"title",text:t("Введите название")}),!1)},P=function(){if(D("description"),!$(n.description).length)return!0;var t=$(n.description).val().replace(/<\/?[^>]*>/gi,"").replace(/&nbsp;/gi," ").replace(/\s\s+/g," ").trim();return!(!$(n.description).hasClass("js-ignore-min")&&""===t||!$(n.description).hasClass("js-ignore-min")&&t.length<$(n.description).data("min")||t.length>$(n.description).data("max")||0!==StopwordsModule._testContacts(t).length)||(s.push({target:"description",text:""}),!1)},C=function(){return!$(n.categorySelect).length||(D("category"),!($(n.categoryWrap).length&&$(n.categoryWrap).is(":visible")&&isNaN(parseInt($(n.categorySelect).val())))||(s.push({target:"category",text:t("Выберите рубрику")}),!1))},x=function(){if(!$(n.subCategoryWrap).length)return!0;D("sub_category");var t=$(n.categorySelect).val(),e=$(n.subCategoryWrap).filter('[data-category-id="'+t+'"]'),s=e.find(n.subCategorySelect);return _(s.val()),!e.length||!isNaN(parseInt(s.val()))},_=function(t){"undefined"!=typeof minPrices&&(minPrices.hasOwnProperty(t)?offer.customMinPrice=minPrices[t]:offer.customMinPrice=minPrices[0],"undefined"!=typeof stageMinPrices?stageMinPrices.hasOwnProperty(t)?offer.stageMinPrice=stageMinPrices[t]:offer.stageMinPrice=stageMinPrices[0]:offer.stageMinPrice=offer.customMinPrice,offer.customMinPrice===offer.customMaxPrice?$(n.price).attr("placeholder",Utils.priceFormat(offer.customMaxPrice,offer.lang)):$(n.price).attr("placeholder",Utils.priceFormat(offer.customMinPrice,offer.lang)+" - "+Utils.priceFormat(offer.customMaxPrice,offer.lang)),0!==t&&(Y(),offer.isOrderStageTester&&(window.offerStages.updateOptionsStageMinPrice(offer.stageMinPrice),window.offerStages.updatePlaceholderPrice(),window.offerStages.validateStagesPrices())))},E=function(){return!($("input[name=want_id]").length&&!$("input[name=want_id]:checked").length)&&(D("category"),D("sub_category"),!0)};_updateCustomPrice=function(){"stages"===$(".js-new-offer-radio.offer-payment-type__radio-item--active").data("type")&&window.offerStages.updateCustomPrice()};var B=function(){if(f)return!0;f=!0,$(c.wrapper).removeClass("hidden"),T(),M(),N(null)},j=function(){if(!f)return!0;f=!1,$(c.wrapper).addClass("hidden"),N(null)},O=function(){if(u)return!0;u=!0,$(c.full).removeClass("hidden"),A(!1)},T=function(){if(!u)return!0;u=!1,$(c.full).addClass("hidden")},M=function(){if(!g)return!0;g=!1,$(c.stages).addClass("hidden")},N=function(t){var e=$(t&&t.currentTarget),s=e&&e.data("type");$(c.radio).removeClass("offer-payment-type__radio-item--active"),e.addClass("offer-payment-type__radio-item--active"),$(c.hint).removeClass("hidden"),"stages"===s?(p="stages",T(),function(){if(g)return!0;g=!0,$(c.stages).removeClass("hidden"),A(!0)}(),S(),_updateCustomPrice()):"all"===s?(p="all",O(),M(),S()):(p=null,$(c.hint).addClass("hidden"),M(),T())},A=function(t){t?$(n.stageDuration).removeAttr("disabled"):$(n.stageDuration).attr("disabled","disabled"),$(n.duration).trigger("chosen:updated")},F=function(){I(),e||$.each(s,(function(t,e){e.text&&i.includes(e.target)&&$(a).find('[data-target="'+e.target+'"] .js-target-error').html(e.text).data("isTemp",!0)}))},W=function(t){1!=t.data("isTemp")&&t.hasClass("no-hide")||t.html("")},D=function(t){if(t){var e=$(a).find('[data-target="'+t+'"] .js-target-error');W(e),s=s.filter((function(e){return e.target!==t}))}else $(a).find(".js-target-error").each((function(t,e){var s=$(e);W(s)}));R()},I=function(){$(".btn-disable-toggle").prop("disabled",!0).addClass("disabled")},R=function(){$(".btn-disable-toggle").prop("disabled",!1).removeClass("disabled")},U=function(){"undefined"==typeof price&&(price=$(this).data("price"));var e=function(t){return Utils.priceFormatWithSign(t,offer.lang,void 0,"₽")},s=$(this).data("commission");void 0===s&&(s=calculateCommission(price,turnover));for(var i="\t\t<h1>"+t("Комиссия Kwork")+"</h1>\t\t\t\t<p>"+t("Комиссия в Kwork снижается по мере того, как растет ваш оборот с конкретным клиентом. Чем больше ваша сумма сделок с отдельным покупателем, тем ниже комиссия Kwork.")+'</p>\t\t\t\t<p class="mt15">'+t("В прошлом оборот с этим клиентом составил:")+"</p>\t\t<p><strong>"+e(s.turnover)+'</strong></p>\t\t\t\t<p class="mt15">'+t("Ваша цена за работу:")+"</p>\t\t<p><strong>"+e(s.price)+'</strong></p>\t\t\t\t<table class="mt15">\t\t\t<thead>\t\t\t\t<tr>\t\t\t\t\t<th>'+t("Оборот с клиентом")+"</th>\t\t\t\t\t<th>"+t("Комиссия")+"</th>\t\t\t\t\t<th>"+t("Ваша цена")+"</th>\t\t\t\t\t<th>"+t("Вы получите")+"</th>\t\t\t\t</tr>\t\t\t</thead>\t\t\t<tbody>\t",r=0;r<s.ranges.length;r++){var a=s.ranges[r];i+="\t\t\t\t<tr"+(a.price?"":' class="disabled"')+">\t\t\t\t\t<td>"+a.title+"</td>\t\t\t\t\t<td>"+100*a.percentage+"%</td>\t\t\t\t\t<td>"+(a.price?e(a.price):"")+"</td>\t\t\t\t\t<td>"+(a.priceWorker?e(a.priceWorker):"n/a")+"</td>\t\t\t\t</tr>\t\t"}i+='\t\t\t</tbody>\t\t\t<tfoot>\t\t\t\t<tr>\t\t\t\t\t<td colspan="2"></td>\t\t\t\t\t<td>'+t("Итого: ")+e(s.price)+"</td>\t\t\t\t\t<td>"+t("Итого: ")+e(s.priceWorker)+'</td>\t\t\t\t</tr>\t\t\t</tfoot>\t\t</table>\t\t<div class="ta-center">\t\t\t<button class="popup__button popup-close-js green-btn m-wMax w250">'+t("Закрыть")+"</button>\t\t</div>\t",show_popup(i,void 0,void 0,"kwork-price-explanation-popup")},q=function(){$(".js-request-kwork-id .empty").remove();var t=$(".js-request-kwork-id option:checked").val();$(".order-extras li").hide();var e=$(".order-extras li[data-pid="+t+"]");e.length>0?(e.show(),K()):t&&(r&&r.abort(),$(".order-extras__list input[type=checkbox]").prop("checked",!1).trigger("change"),r=$.ajax({url:"/api/extras/getbykwork",type:"post",dataType:"json",data:{kwork_id:t},success:function(e){if(r=null,!0===e.success){for(var s in e.extras)if(e.extras.hasOwnProperty(s)){var i=e.extras[s],a="";a='<li class="order-extras__item order-extras__item_old" data-pid="'+t+'" data-id="'+i.id+'" style="display:none;"><input class="order-extras__input styled-checkbox" data-payer-price="'+i.payerPrice+'" data-price="'+i.price+'" data-time="'+i.duration+'" data-id="'+i.id+'" name="gextras[]" type="checkbox" value="'+i.id+'"><label for="order-extras_'+i.id+'" class="w460">'+i.name.ucFirst()+'</label><div class="order-extras__select-block"><select class="js-order-extras__count styled input input_size_s" data-affected-checkbox="'+i.id+'" id="extra_count'+i.id+'" name="extra_count'+i.id+'">';for(var o=0;o<offer.maxKworkCount;o++){var n=o+1,l=calculateCommission(i.payerPrice*n,turnover);a+='<option value="'+n+'">'+n+" ("+Utils.priceFormatWithSign(l.priceWorker,offer.lang,"&nbsp;","Р")+")</option>"}a+="</select></div></li>",$(".order-extras__list").prepend(a),$(".js-order-extras__count[data-affected-checkbox]").on("change",(function(t){var e=$(t.delegateTarget);$('.order-extras__item_old[data-id="'+e.data("affected-checkbox")+'"] .order-extras__input').prop("checked",!0)})),$(".order-extras li[data-pid="+t+"]").show(),$(".order-extras li[data-pid="+t+"] select").chosen({width:"108px",disable_search:!0})}K()}}})),$(".order-extras li.custom").show()},K=function(){var e,s,i,r=$(".js-request-kwork-id option:selected"),a=r.data("package"),o=r.data("rate")||offer.multiKworkRate;if(1!==a)e=0^$(".js-request-kwork-count").val(),s=e*r.data("price"),i=0^r.data("time");else{var n=$(".js-request-kwork-package-type").val();if(!n)return!1;var l=offer.kworkPackages[$(".js-request-kwork-id").val()][n];e=1,s=parseFloat(l.payerPrice),i=0^l.duration}if(r.data("base-volume")>0){var c=r.data("base-volume");i=getVolumedDuration(i,c,c*e,"offer")}else i=getDuration(i,e,o);$(".order-extras__item_old").each((function(){var t=$(this).find(".order-extras__input"),e=$("#extra_count"+t.val()),r=0^t.data("payerPrice"),a=0^t.data("time"),n=0^e.val(),l=calculateCommission(r,turnover);t.data("price",l.priceWorker),e.find("option").each((function(){var t=parseInt($(this).prop("value")),e=calculateCommission(r*t,turnover),s=Utils.priceFormatWithSign(e.priceWorker,offer.lang," ","Р");$(this).text(t+" ("+s+")")})),e.trigger("chosen:updated"),t.is(":checked")&&(s+=r*n,i+=getDuration(a,n,o))})),$(".order-extras__item.custom").each((function(){var t=$(this),e=t.find(".js-new-extra-price"),r=t.find(".js-new-extra-days"),a=0^e.find("option:checked").data("payerValue"),n=0^r.val();e.find("option").each((function(){var t=parseFloat($(this).data("payerValue")),e=calculateCommission(t,turnover),s=Utils.priceFormatWithSign(e.priceWorker,offer.lang," ","Р");$(this).text(s).data("seller-value",e.priceWorker).attr("data-seller-value",e.priceWorker)})),e.trigger("chosen:updated"),s+=1*a,i+=getDuration(n,1,o)})),L(turnover);var h=calculateCommission(s,turnover),f=h.priceWorker,u=Utils.priceFormat(s,offer.lang,"&nbsp;"),g=Utils.priceFormat(f,offer.lang,"&nbsp;");d=s,"ru"===offer.lang?(u+='&nbsp;<span class="rouble">Р</span>',g+='&nbsp;<span class="rouble">Р</span>'):(u='<span class="usd">$</span>'+u,g='<span class="usd">$</span>'+g),$(".js-total-sum").html(t("Стоимость: ")+u);var p=t("Вы получите")+": "+g+' <a href="javascript:;" class="js-price-explanation kwork-price-explanation">'+t("Подробнее")+"</a>",m=$(".js-total-worker-sum");m.html(p),m.closest(".js-active-kwork, .js-individual-kwork").find(".js-price-explanation").data("commission",h),$(".js-total-time").html(i+" "+Utils.declOfNum(i,[t("день"),t("дня"),t("дней")]))},Y=function(){var e=$(n.price),i=$("#kwork-price-description");if(!e.is(":visible"))return!0;if(function(){D("price");var e=$(n.price);if(!e.is(":visible"))return!0;/[^0-9]/gi.test(e.val())&&e.val(e.val().replace(/[^0-9]/gi,""));var i=parseInt(e.val());return isNaN(i)?(s.push({target:"price",text:t("Введите стоимость")}),!1):(h=i,i<offer.customMinPrice||i>offer.customMaxPrice?offer.customMinPrice===offer.customMaxPrice?(s.push({target:"price",text:t("Стоимость должна быть равна {{0}}",[Utils.priceFormatWithSign(offer.customMinPrice,offer.lang)])}),!1):(s.push({target:"price",text:t("Стоимость может быть от {{0}} до {{1}}",[Utils.priceFormatWithSign(offer.customMinPrice,offer.lang),Utils.priceFormatWithSign(offer.customMaxPrice,offer.lang)])}),!1):(i>=offer.stagesPriceThreshold&&offer.isOrderStageTester?B():(j(),O()),!0))}()){var r=0^e.val(),a=calculateCommission(r,turnover),o=r-a.priceKwork,l=t("Вы получите {{0}}",[Utils.priceFormatWithSign(o,offer.lang)]);return l+=' <a href="javascript:void(0);" class="js-price-explanation kwork-price-explanation">'+t("Подробнее")+"</a>",i.html(l),e.closest(".js-custom-kwork, .js-individual-kwork").find(".js-price-explanation").data("commission",a),!0}return i.html(""),!1},z=function(){var e=$(this),s='<li class="order-extras__item extrasping-settings extra-field-block-css extra-edit-block-css custom"><div class="offer-sprite offer-sprite-option pull-left m-hidden mt2"></div><input name="customExtraName[]" maxlength="50" value="" style="width:340px;" class="styled-input f14 pull-left m-wMax m-border-box order-new-extras__input" type="text"><div class="new-order-extras__select-block"><select id="extratime" class="js-new-extra-select js-new-extra-days input input_size_s" name="customExtraTime[]" style="width:16%;"><option value="0"> '+t("{{0}} дней",[0])+' </option><option value="1"> '+t("{{0}} день",[1])+' </option><option value="2"> '+t("{{0}} дня",[2])+' </option><option value="3"> '+t("{{0}} дня",[3])+' </option><option value="4"> '+t("{{0}} дня",[4])+' </option><option value="5"> '+t("{{0}} дней",[5])+' </option><option value="6"> '+t("{{0}} дней",[6])+' </option><option value="7"> '+t("{{0}} дней",[7])+' </option><option value="8"> '+t("{{0}} дней",[8])+' </option><option value="9"> '+t("{{0}} дней",[9])+' </option><option value="10"> '+t("{{0}} дней",[10])+' </option></select><div class="custom-option-price"><select name="customExtraPrice[]" class="js-new-extra-select js-new-extra-price input input_size_s" style="width:16%;">'+offer.customPricesOptionsHtml+'</select></div></div><div class="js-new-order-extras-delete new-order-extras__delete del-opt cur ml6 dib" data-id="0" title="'+t("Удалить")+'"><i class="ico-close-14"></i></div><div class="clear"></div></li>',i=$(s);i.find(".js-new-extra-price").chosen({width:"100px",disable_search:!0}),i.find(".js-new-extra-days").chosen({width:"80px",disable_search:!0}),$(".order-extras__list").append(i),$("#message_body").trigger("input"),$(e).text(t("Создать еще опцию")),K(),I()},G=function(){$(this).closest("li").remove(),$("#message_body").trigger("input"),$(".js-add-extras li.extrasping-settings").length<1&&$("#order-extras__create").text(t("Создать опцию")),K(),S()},L=function(t){$(".max-custom-options-tooltip").remove();var e=$(".order-extras__list li.custom"),s=calculateCommission(window.maxOptionsSum,t),i=function(){for(var t=0,e=$(".order-extras__list li.custom"),s=0;s<e.length;s++){var i=$(e[s]);t+=clearPriceStr(i.find("select.js-new-extra-price option:selected").data("sellerValue"))}return t}(),r=0;$("li.order-extras__item_old").each((function(){$(this).is(":visible")&&($input=$(this).find("input.order-extras__input"),r+=$input.data("price"))}));var a=i+r;if(i>0){var o="Общая цена всех доп. опций - до "+Utils.priceFormatWithSign(s.priceWorker,offer.lang," ","руб.")+" Сейчас "+Utils.priceFormatWithSign(a,offer.lang," ","руб.");e.last().parent().append("<div class='max-custom-options-tooltip'>"+o+"</div>")}var n=$("#track-send-message-button");a<=s.priceWorker?(n.removeClass("btn_disabled").prop("disabled",!1),e.removeClass("custom-price-error"),$(".js-order-extras-create").show()):(n.addClass("btn_disabled").prop("disabled",!0),e.addClass("custom-price-error"),$(".max-custom-options-tooltip").addClass("error").html(o+"<br>Уменьшите стоимость предыдущих опций, чтобы добавить еще одну"),$(".js-order-extras-create").hide())};return{init:function(){v(),$(document).on("change",".js-request-kwork-id",(function(){$(this).val()?($(".js-send-request__total").show(),$(".js-order-extras").show()):($(".js-send-request__total").hide(),$(".js-order-extras").hide()),$(this).find("option:checked").data("package")?($(".request-kwork-count-block").hide(),$(".request-kwork-package-block").show()):($(".request-kwork-count-block").show(),$(".request-kwork-package-block").hide()),K(),S()})).on("change",".js-request-kwork-count, .js-request-kwork-package-type, .order-extras__input, .js-order-extras__count, .js-new-extra-select",(function(){K(),S()})).on("click",".order-extras__item",(function(t){var e=$(".styled-checkbox[data-id="+$(this).data("id")+"]");e.prop("checked")?$(t.target).is(".chosen-container")||0!==$(t.target).closest(".chosen-container").length||e.prop("checked",!1).trigger("change"):e.prop("checked",!0).trigger("change")})).on("change",".js-new-extra-price",(function(){var t=$(this).find("option:checked").data("sellerValue"),e=$(this).closest(".new-order-extras__select-block").find(".js-new-extra-count");e.find("option").each((function(){var e=t*$(this).attr("value");$(this).text($(this).attr("value")+"("+Utils.priceFormatWithSign(e,offer.lang)+")")})),e.trigger("chosen:updated")})).on("change",".js-request-kwork-id",q).on("click",".js-new-order-extras-delete",G).on("click",".js-order-extras-create",z).on("input","input[name=want_id]",S).on("input",'input[name="customExtraName[]"]',S).on("change",n.categorySelect,k).on("change",n.duration,S).on("input",n.title,S).on("input",n.volume,S).on("input",n.price,S).on("blur",n.price,_updateCustomPrice).on("input",n.categorySelect,S).on("input",n.subCategorySelect,S).on("input",n.description,S).on("click",".js-price-explanation",U).on("click","#change-to-kwork-choose",(function(){$("#suggestCustomKworkToggle, #change-to-kwork-choose").addClass("hidden"),$("#suggestKworkToggle, #change-to-custom-kwork").removeClass("hidden")})).on("click","#change-to-custom-kwork",(function(){$("#suggestKworkToggle, #change-to-custom-kwork").addClass("hidden"),$("#suggestCustomKworkToggle, #change-to-kwork-choose").removeClass("hidden")})),$(c.radio).on("click",N),offer.isOrderStageTester&&(window.offerStages.onChangeStage=function(){S(!1)}),m()},btnDisable:I,btnEnable:R,validateIndividualKwork:S,showBackendError:function(t){I(),t.errors?$.each(t.errors,(function(t,e){$(a).find('[data-target="'+e.target+'"] .js-target-error').html(e.text)})):$(o).html(t.error),offer.isOrderStageTester&&t.errors&&window.offerStages.showBackendStageErrors(t.errors)},clearShowErrorForBlock:function(){e=!1,s=[],i=[]},setSerialize:function(t){"stages"===t?($(".js-stage-name").removeClass("no-serialize"),$(".js-stage-price").removeClass("no-serialize"),$(".js-kwork-title").addClass("no-serialize"),$(".js-kwork-volume").addClass("no-serialize")):($(".js-kwork-title").removeClass("no-serialize"),$(".js-kwork-volume").removeClass("no-serialize"),$(".js-stage-name").addClass("no-serialize"),$(".js-stage-price").addClass("no-serialize"))},hidePaymentType:j,selectPaymentType:N}}()}});