!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=143)}({143:function(t,e,r){t.exports=r(144)},144:function(t,e,r){"use strict";r.r(e);var n=r(67);r(65),$(document).ready((function(){$("#offer_kwork_form").length>0&&(window.offerForm=new n.a("#offer_kwork_form",{onUpdate:window.OfferIndividualModule.validateIndividualKwork}))}))},65:function(t,e){window.htmlToText=function(t,e){t=(t=t.replace(/\r?\n/g,"")).replace(/<[\s]*\/[\s]*?img[\s]*?>/g,"");for(var r=0,n=[],i="",o="",a="",u=0;u<t.length;u++){var l=t[u];if(0==r)"<"==l?(a=l,r=1):o+=l;else if(1==r&&(a+=l,">"==l)){var s=a.match(/^<[\/\s]*?([^\/\s>]+)/)[1];"img"==s?e&&(o.length>0&&(n.push(i+o),i="",o=""),i+=a):"br"==s?(n.push(i+o),i="",o=""):"p"!=s&&"div"!=s||o.length>0&&(n.push(i+o),i="",o=""),r=0}}if((i.length>0||o.length>0)&&n.push(i+o),t=n.join("\n"),e){var d=new RegExp("<img[^>]+?"+window.filesMiniatureUrl+"[^>]+?>","gi");t=t.replace(d,(function(t){var e=$($.parseHTML(t));e.attr("src").replace(window.filesMiniatureUrl+"/","");return'[attached-img id="'+e.data("id")+'"]'}))}return t=t.replace(/<\/?[^>]*>/gi,""),t=(t=he.decode(t)).replace(/^[ \r\n\f\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},67:function(e,r,n){"use strict";function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}n.d(r,"a",(function(){return o}));var o=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.onUpdate=n.onUpdate,this.formEl=$(r),this.bottomError=this.formEl.find(".vf-bottom-error"),this.textCheckErrors={bad_words:t("Исключите запрещенные слова: "),duplicate_symbols:t("Текст не соответствует нормам русского языка.\nОтредактируйте слова, подчеркнутые красным."),big_word:t("Превышена максимальная длина слов"),small_word:t("Текст не соответствует нормам русского языка.\nОтредактируйте слова, подчеркнутые красным."),word_mistakes:t("Необходимо исправить ошибки или опечатки в тексте.\nСлова с ошибками подчеркнуты красным.")},this.plannedCheck={},this.textCheckTimeout=null,this.textCheckXhr=null,this.fields={},this.isBusy=!1,this.initEventListeners()}var r,n,o;return r=e,(n=[{key:"isValidated",value:function(t){if(this.isBusy)return!1;var e=!0;return $.each(this.fields,(function(r,n){return!(!t||-1!=$.inArray(r,t))||("success"!=n.status?(e=!1,!1):void 0)})),e}},{key:"initEventListeners",value:function(t){var e=this,r=this.formEl;t&&(r=t),r.find(".vf-block").each((function(t,r){var n=$(r),i=n.data("name");if(!i)return!0;if(n.data("initialized"))return!0;var o=n.find(".vf-field"),a=!0===o.data("mistakePercentLong")?1:0,u=o.data("noHint")?1:0,l=o.data("fieldId"),s=!1,d=null,c=n.data("errorOutput");c&&((d=n.find(c)).length?s=!0:d=null);var f=n.find(".vf-error"),h=f.length>0&&f.hasClass("no-hide"),p=o.data("en");e.fields[i]={block:$(r),errorOutput:f,errorNoHide:h,el:o,isLong:a,noHint:u,fieldId:l,status:"success",en:p,errorOutputToData:s,errorOutputDataBlock:d},o.on("input",(function(){e.checkField(i)})),n.data("initialized",!0)}))}},{key:"checkField",value:function(t){var e=this,r=this.fields[t];!r.errorOutputToData&&(!r.errorNoHide||r.errorOutput.data("isTemp"))&&r.errorOutput.length>0&&r.errorOutput.text(""),this.isBusy=!0,this.onUpdate&&this.onUpdate(),this.textCheckXhr&&this.textCheckXhr.abort();var n={string:r.el.html(),isLong:r.isLong,noHint:r.noHint};r.fieldId&&(n.field=r.fieldId),this.plannedCheck[t]=n,this.textCheckTimeout&&(clearTimeout(this.textCheckTimeout),this.textCheckTimeout=null),this.textCheckTimeout=setTimeout((function(){var t={data:e.plannedCheck,lang:r.en?"en":"ru",checkAll:!0};e.textCheckXhr=$.post("/api/kwork/checktext",t,(function(t){if(e.textCheckXhr=null,e.plannedCheck={},r.errorOutputToData?r.errorOutputDataBlock.data("backendError",""):r.errorNoHide&&r.errorOutput.length>0&&r.errorOutput.text(""),"data"in t){var n=rangy.getSelection().getAllRanges(),i=_.last(n),o=null;i&&(o=$(i.startContainer).closest(".js-content-editor"));var a=!1;o&&o.length>0&&(a=!0);var u=null;if(a)try{u=rangySelectionSaveRestore.saveSelection()}catch(t){}if(e.isBusy=!1,e.handleBackendValidation(t),a&&u)try{rangySelectionSaveRestore.restoreSelection(u)}catch(t){}}}))}),1e3)}},{key:"reset",value:function(){this.formEl.find(".vf-error").text("")}},{key:"handleBackendValidation",value:function(t){var e=this,r=t.error||t.response||"",n=t.data||t.errorsDetail||t.errors||[];$.each(n,(function(t,n){var i=n.target||t,o="",a=n.validError||n.text||"";if(a&&(o=a,a in e.textCheckErrors&&(o=e.textCheckErrors[a])),"badWords"in n&&n.badWords&&(o=e.textCheckErrors.bad_words+n.string),!(i in e.fields))return o.length>0&&(r+="<div>"+o+"</div>"),!0;var u=e.fields[i],l=u.el.html(),s=n.mistakes||[],d=applyWordErrors(l,s);u.el.html(d),u.status=o.length>0?"error":"success",u.errorOutputToData?(u.errorOutputDataBlock.data("backendError",o),u.errorOutputDataBlock.trigger("input"),(!u.errorNoHide||u.errorOutput.data("isTemp"))&&u.errorOutput.length>0&&u.errorOutput.text("")):u.errorOutput.length>0?u.errorOutput.html(o).data("isTemp",!1):r+="<div>"+o+"</div>"})),r.length>0&&this.bottomError.length>0&&this.bottomError.html(r),this.onUpdate&&this.onUpdate()}}])&&i(r.prototype,n),o&&i(r,o),e}()}});