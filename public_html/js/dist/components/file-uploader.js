!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=160)}({160:function(e,t,n){e.exports=n(161)},161:function(e,n){function i(e,t,n,i){var a,r,l,o=window.jQuery,s=t,d=n,c={},u=!0===i,f=function(){var t=o('<div class="file-item file-uploader__item">'),n=m(s.name);t.append('<i class="file-item__ext '+n+'">');var i=o('<span class="file-item__name">').text(s.name);t.append(i);var r=o('<a class="file-item__action">');r.append('<i class="file-item__action-ico">'),t.append(r);var l=o('<div class="file-item__error hidden">');t.append(l);var f=o('<div class="file-item__loader" style="width: 0">');t.append(f);var p=o('<input type="hidden" name="'+d.input.name+'[delete][]">'),_=o('<input type="hidden" name="'+d.input.name+'[new][]">');(c={$container:t,$name:i,$actionBtn:r,$deleteInput:p,$newInput:_,$error:l,$loader:f}).$actionBtn.on("click",(function(){if(u)F("error")||e.__totalFiles("dec"),w(u),void 0!==a&&0==a.status&&a.abort(),e.__removeFileBlock(s.name);else{if(c.$container.data("onDelete"))e.__totalFiles()<e.__maxFileCount()&&(e.__totalFiles("inc"),C());else{var t=e.__getOptions();if(t.deleteCallback){t.deleteCallback(s,(function(){S()}))}else e.__totalFiles("dec"),$()}o(d.selector).trigger("fileUploader.change")}B()}))},p=function(){c.$loader.addClass("file-item__loader_success").animate({opacity:0}),c.$container.data("uploaded",!0);try{var t=JSON.parse(this.responseText)}catch(e){t={result:"error"}}"success"===t.result?g(t.file_id):(y("error"),x(t.reason),e.__totalFiles("dec"),k("success"))},_=function(){y("error"),x("default"),e.__totalFiles("dec")},h=function(e){var t=e.loaded/e.total*100^0;c.$loader.css("width",t+"%")},v=function(){k("abort")},g=function(e){e^=0,c.$newInput.val(e),c.$container.append(c.$newInput),k("success")},m=function(e){var t=e.length,n=e.substr(t-3,t).toLowerCase(),i=e.substr(t-4,t).toLowerCase();return-1!=o.inArray(n,["doc","xls","rtf","txt"])||-1!=o.inArray(i,["docx","xlsx"])?"ico-file-doc":-1!=o.inArray(n,["zip","rar"])?"ico-file-zip":-1!=o.inArray(n,["png","jpg","gif","psd"])||-1!=o.inArray(i,["jpeg"])?"ico-file-image":-1!=o.inArray(n,["mp3","wav","avi"])?"ico-file-audio":"ico-file-zip"},b=function(){return s.size<=l},w=function(e){c.$container.animate({opacity:0,height:0,margin:0},200,(function(){e&&(c.$container.remove(),c=null),o(d.selector).trigger("fileUploader.change")}))},y=function(e){switch(e){case"deleted":c.$container.addClass("file-item_type_deleted");break;case"error":c.$container.addClass("file-item_type_error")}},F=function(e){switch(e){case"deleted":var t=c.$container.hasClass("file-item_type_deleted");break;case"error":t=c.$container.hasClass("file-item_type_error")}return t},x=function(e){var t=d.errors.default;d.errors[e]&&(t=d.errors[e]),c.$error.html(t).removeClass("hidden")},$=function(){s.id&&(y("deleted"),c.$container.append(c.$deleteInput),c.$deleteInput.val(s.id),c.$container.data("onDelete",!0))},C=function(){!function(e){switch(e){case"deleted":c.$container.removeClass("file-item_type_deleted");break;case"error":c.$container.removeClass("file-item_type_error")}}("deleted"),c.$deleteInput.detach(),c.$container.data("onDelete",!1)},k=function(e){r=e},S=function(){null!==c&&(c.$container.remove(),e.__totalFiles("dec"))},B=function(){d.onChange&&d.onChange()};return f(),l=1048576*d.maxSize,{upload:function(){if(!b())return y("error"),x("file_size_exceed"),e.__totalFiles("dec"),!1;a=new XMLHttpRequest;var t=new FormData;t.append("upload_files",s),"undefined"!=typeof kworkLang&&t.append("lang",kworkLang),a.addEventListener("load",p),a.addEventListener("error",_),a.addEventListener("abort",v),a.upload.onprogress=h,a.open("POST","/api/file/upload",!0),k("load"),a.send(t)},get:function(){return c.$container},getFileName:function(){return s.name},status:function(){return r},destroy:S,hideError:function(){c.$error.html("").addClass("hidden")},checkError:function(){return c.$container.hasClass("file-item_type_error")},onChangeFile:B}}window.FileUploader=function(e){"use strict";var n,a=window.jQuery,r={lang:{withFiles:t("Прикрепить ещё файл"),withoutFiles:t("Прикрепить файл")},errors:{default:t("Ошибка загрузки изображения"),file_size_exceed:t('Файл больше {{0}}Мб не отправится. Используйте файлообменник, например, <a href="https://disk.yandex.ru/" target="_blank">Яндекс.Диск</a>.',[config.files.maxSize]),no_file_uploaded:t("Не загружен файл"),not_allowed:t("Тип файла недопустим для загрузки"),user_non_authorized:t("Пользователь не авторизирован"),invalid_filename:t("Название файла должно быть на английском")},isMultiple:!0,maxFiles:config.files.maxCount,maxSize:config.files.maxSize},l={},o=0,s=[],d=!0;this.__construct=function(e){a.extend(r,e),a.extend(r.lang,{hint:t("до {{0}} файлов не более {{1}} Мб",[r.maxFiles,r.maxSize])}),n=this,l.container=a(r.selector);var i=l.container.data("allowUpload");void 0!==i&&(d=!!i),f(),p(),_(),void 0!==r.files&&r.files.length?v(r.lang.withFiles):v(r.lang.withoutFiles),this.__setEvents()};var c=function(){return r.hasOwnProperty("isMultiple")&&!1===r.isMultiple?1:0^r.maxFiles};this.__maxFileCount=c;var u=function(e){return isNaN(o)&&(o=0),"inc"===e?(++o>=c()&&l.fileAddButton.hide(),a(window).trigger("changeFileCount.fileUploader"),o):"dec"===e?(--o<c()&&l.fileAddButton.show(),a(window).trigger("changeFileCount.fileUploader"),o=o<0?0:o):o};this.__totalFiles=u;var f=function(){var e=a('<input type="file" class="file-uploader__file-input">');r.isMultiple&&e.prop("multiple",!0),l.fileInput=e;var t=a('<label class="file-uploader__add d-flex_kwork-edit flex-wrap justify-content-between align-items-baseline">'),n=a('<div class="mr5">');n.append(l.fileInput),t.append(n),n.append('<i class="icon ico-clip file-uploader__add-ico"></i>');var i=a('<span class="file-uploader__add-text"></span>');if(n.append(i),r.lang.hasOwnProperty("hint")){var o=a('<span class="file-uploader__add-hint">'+r.lang.hint+"</span>");t.append(o)}l.fileAddButton=t,l.fileAddButtonLabel=i,l.container.append(t),d||l.fileAddButton.hide()},p=function(){l.loadFileList=a('<div class="load-file__list">'),l.container.append(l.loadFileList)};this.__setEvents=function(){var e=this;l.fileInput.on("change",(function(){v(r.lang.withFiles);for(var t=0;t<this.files.length;t++){if(u()>=c())break;if(this.files[t]){var n=new i(e,this.files[t],r,!0);l.loadFileList.append(n.get()),u("inc"),n.upload(),s.push(n)}}if(l.container.trigger("fileUploader.change"),a(this).val(""),!e.__canSave()){var o=setInterval((function(){e.__canSave()&&(clearInterval(o),e.__enableButton(),n.onChangeFile())}),100);return e.__disableButton(),n.onChangeFile(),!1}return!1}))};var _=function(){if(void 0!==r.files&&r.files.length)for(var e=0;e<r.files.length;e++){var t=r.files[e];if(t){var a=new i(n,t,r);l.loadFileList.append(a.get()),u("inc")}}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(void 0!==r.files&&r.files.length)for(var t=0;t<r.files.length;t++){var a=r.files[t];if(a){var o=new i(n,a,r,e);l.loadFileList.append(o.get()),u("inc"),s.push(o)}}},v=function(e){l.fileAddButtonLabel.text(e)};return this.__construct(e),this.__canSave=function(){for(var e=0;e<s.length;e++){var t=s[e];if("load"==t.status()||t.checkError())return!1}return!0},this.__hasErrors=function(){for(var e=0;e<s.length;e++){if(s[e].checkError())return!0}return!1},this.__canUpload=function(e){return void 0!==e&&(d=e,l.fileAddButton.toggle(d)),d},this.__clear=function(){for(var e=Object.keys(s),t=0;t<e.length;t++){var n=e[t];s[n].destroy(),delete s[n]}return s=[],v(r.lang.withoutFiles),!0},this.__removeFileBlock=function(e){s=s.filter((function(t){return t.getFileName()!=e}))},this.__getOptions=function(){return r},this.__disableButton=function(){void 0!==r.buttonDisabled&&a(r.buttonDisabled).prop("disabled",!0).attr("disabled",!0).addClass("disabled btn_no-hover")},this.__enableButton=function(){void 0!==r.buttonDisabled&&a(r.buttonDisabled).prop("disabled",!1).attr("disabled",!1).removeClass("disabled btn_no-hover")},{totalFiles:u,hasErrors:this.__hasErrors,canSave:this.__canSave,canUpload:this.__canUpload,clear:this.__clear,update:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r.files=e,h(t),void 0!==r.files&&r.files.length?v(r.lang.withFiles):v(r.lang.withoutFiles)}}}}});